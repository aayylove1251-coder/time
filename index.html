<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D 真實模擬鬧鐘</title>
    <style>
        body { margin: 0; background: #1a1a1a; overflow: hidden; font-family: sans-serif; }
        #info { position: absolute; top: 10px; width: 100%; text-align: center; color: white; pointer-events: none; }
    </style>
</head>
<body>
    <div id="info">正在讀取 3D 鬧鐘模型...</div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, controls;
        let hourHand, minuteHand, secondHand;

        function init() {
            // 1. 場景設定
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x222222);

            // 2. 相機設定
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 0, 5);

            // 3. 渲染器
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // 4. 光源
            const ambientLight = new THREE.AmbientLight(0xffffff, 1);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 2);
            dirLight.position.set(5, 5, 5);
            scene.add(dirLight);

            // 5. 控制器 (可以旋轉視角觀賞)
            controls = new OrbitControls(camera, renderer.domElement);

            // 6. 載入 GLB 模型
          // ... (前面 scene, camera 設定保持不變)

let hourHand, minuteHand, secondHand;

const loader = new GLTFLoader();
loader.load('./clock.glb', (gltf) => {
    const model = gltf.scene;
    scene.add(model);

    // 關鍵修正：根據你的 GLB 元數據，名稱通常是 "Hour", "Minute", "Second"
    // 注意：JavaScript 對大小寫很敏感
    hourHand = model.getObjectByName('Hour');
    minuteHand = model.getObjectByName('Minute');
    secondHand = model.getObjectByName('Second');

    // 檢查是否抓到物件
    if(!hourHand || !minuteHand || !secondHand) {
        console.warn("找不到指針物件，請檢查模型內部的命名");
    }

    animate();
}, undefined, (error) => {
    console.error("載入失敗:", error);
});

function updateClock() {
    if (!hourHand || !minuteHand || !secondHand) return;

    const now = new Date();
    const hours = now.getHours();
    const minutes = now.getMinutes();
    const seconds = now.getSeconds();
    const msec = now.getMilliseconds();

    // 1. 計算旋轉角度 (弧度)
    // 秒針：每秒 6 度
    const sAngle = (seconds + msec / 1000) * (Math.PI / 30);
    // 分針：每分 6 度 + 秒針補償
    const mAngle = (minutes * 6 + seconds / 10) * (Math.PI / 180);
    // 時針：每小時 30 度 + 分針補償
    const hAngle = ((hours % 12) * 30 + minutes / 2) * (Math.PI / 180);

    // 2. 修正旋轉軸向
    // 如果你的秒針「轉錯方向」或是「歪了」，通常是因為 3D 空間的 XYZ 軸與你想像的不同
    // 嘗試切換這裡的 .rotation.z 到 .rotation.y 或 .rotation.x
    // 大多數 GLB 模型在 Three.js 中是繞著 Z 軸轉動（面朝相機）
    
    // 請將下列的 '-' 符號根據你的模型導向調整（順時針 vs 逆時針）
    secondHand.rotation.z = -sAngle;
    minuteHand.rotation.z = -mAngle;
    hourHand.rotation.z = -hAngle;
}
